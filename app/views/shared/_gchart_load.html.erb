<%= content_for :gcharts_references do %>
  <script type="text/javascript">
    window.onload = function (){
      charts = $(".report-chart ")
      $.each(charts, function(i, chart){
        var chart_type = $(chart).data("type");
        var chart_options = $(chart).data("chart-options");
        var id = $(chart).attr("id");
        var container_class = $(chart).attr("class");
        var canvas_width = $(chart).data("width");
        var canvas_height = $(chart).data("height");
        var r = null;
        var radius = 0 ;
        var chart_top = null;
        var title_top = null;
        var font = "";
        if(container_class.indexOf("chart-copy") < 0){
          r = Raphael(id);
          radius = 100;
          chart_top = {x:200,y:150};
          title_top = {x:240,y:30};
          font = "16px sans-serif";
        }
        else{
          r = Raphael(id,canvas_width,canvas_height);
          radius = 350;
          chart_top = {x:750,y:450};
          title_top = {x:750,y:50}
          font = "30px sans-serif";
        }
        var rect = r.rect(0, 0, canvas_width, canvas_height);
        rect.attr("fill", "#fff");
        rect.attr("stroke", "#fff");
        switch(chart_type){
          case "pie":
            data_json = $(chart).data("env")
            total = data_json.likeable + data_json.unlikable + data_json.indiferent;
            likeable_percent = ((data_json.likeable / total) * 100).toFixed(2);
            unlikable_percent = ((data_json.unlikable / total) * 100).toFixed(2);
            indiferent_percent = ((data_json.indiferent / total) * 100).toFixed(2);
            data = [data_json.likeable, data_json.unlikable,data_json.indiferent ]
            pie = r.piechart(chart_top.x, chart_top.y,radius,data,{legend: ["Satisfactorio " +likeable_percent+ "%" ,"Insastifactorio " +unlikable_percent+ "%","No Aplica " +indiferent_percent+ "%"],legendpos: "east"});
            r.text(title_top.x, title_top.y,chart_options.title  ).attr({ font: font });
            pie.hover(function () {
                    this.sector.stop();
                    this.sector.scale(1.1, 1.1, this.cx, this.cy);

                    if (this.label) {
                        this.label[0].stop();
                        this.label[0].attr({ r: 7.5 });
                        this.label[1].attr({ "font-weight": 800 });
                    }
                }, function () {
                    this.sector.animate({ transform: 's1 1 ' + this.cx + ' ' + this.cy }, 500, "bounce");

                    if (this.label) {
                        this.label[0].animate({ r: 5 }, 500, "bounce");
                        this.label[1].attr({ "font-weight": 400 });
                    }
                });
            break;
          case "barchart":
            break
        }
        
      });
    }
  </script>
<% end %>